name: AWS CloudFormation Deployment

on:
    workflow_dispatch:
        inputs:
           Universe:
             description: 'Universe'
             required: true
             default: 'dev'

    
env:
    aws-region: ap-south-1


permissions:
    id-token: write
    contents: read
    actions: read

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: configure aws credentials
      uses: aws-actions/configure-aws-credentials@v4
      with:
        role-to-assume: arn:aws:iam::058264087706:role/TestingAB
        role-session-name: emojiSession
        aws-region: ${{env.aws-region}}
    
    - name: Deploy to ecr
      run: |
        aws ecr get-login-password --region ap-south-1 | docker login --username AWS --password-stdin 058264087706.dkr.ecr.ap-south-1.amazonaws.com
    

    # - name: Deploy CloudFormation stack
    #   run: |
    #     aws cloudformation deploy \
    #     --stack-name abstack \
    #     --template-file normecs.yml \
    #     --parameter-overrides \
    #       Universe=${{inputs.Universe }} \
    #       SubnetID=subnet-0961246da2943af47 \
    #     --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM \
    #     --no-fail-on-empty-changeset \
    #     --tags \
    #       bv:nexus:team=emodb-dev@bazaarvoice.com \
    #       bv:system=emodb \
    #       bv:nexus:service=megabus \
    #       bv:nexus:role=app \
    #       bv:nexus:owner=emodb-dev@bazaarvoice.com \
    #       bv:nexus:access=none \
    #       bv:nexus:costcenter=emodb-dev@bazaarvoice.com \
    #       bv:nexus:datatype=client+personal \
    #       universe=${{ inputs.Universe }} \
    #       service=ABtesting
    #   env:
    #     AWS_DEFAULT_REGION: <region>


  # Add more jobs or steps as needed
